# Spring Cache & Redis μ‹¤λ¬΄ κ°€μ΄λ“

Springμ μΊμ‹ μ¶”μƒν™”(`@Cacheable`)μ™€ Redisλ¥Ό ν™μ©ν•μ—¬ μ„±λ¥μ„ μµμ ν™”ν•λ” λ°©λ²•μ„ ν•™μµν•©λ‹λ‹¤.

## π“ μ–Έμ  μ‚¬μ©ν•λ”κ°€?

### β… λ°λ“μ‹ μ‚¬μ©ν•΄μ•Ό ν•λ” κ²½μ°
1. **μ΅°νκ°€ λ§μ€ λ°μ΄ν„°**: μƒν’ λ©λ΅, μΈκΈ° κ²μ‹κΈ€, ν™ ν™”λ©΄ λ°μ΄ν„°
2. **λ³€κ²½μ΄ μ μ€ λ°μ΄ν„°**: μΉ΄ν…κ³ λ¦¬, μ½”λ“ ν…μ΄λΈ”, μ„¤μ • μ •λ³΄
3. **κ³„μ‚° λΉ„μ©μ΄ λ†’μ€ λ°μ΄ν„°**: λ³µμ΅ν• ν†µκ³„, μ§‘κ³„ μΏΌλ¦¬ κ²°κ³Ό
4. **μ™Έλ¶€ API μ‘λ‹µ**: ν™μ¨, λ‚ μ”¨ λ“± λ³€κ²½ μ£ΌκΈ°κ°€ κΈ΄ μ™Έλ¶€ λ°μ΄ν„°
5. **μ„Έμ… λ°μ΄ν„°**: λ΅κ·ΈμΈ μƒνƒ, μ¥λ°”κµ¬λ‹ (Redis Session)

### π― μΊμ‹ μ μ© ν¨κ³Ό
- **μ‘λ‹µ μ‹κ°„ λ‹¨μ¶•**: DB μ΅°ν 500ms β†’ μΊμ‹ μ΅°ν 5ms (100λ°° ν–¥μƒ)
- **DB λ¶€ν• κ°μ†**: λ°λ³µ μΏΌλ¦¬λ¥Ό λ§‰μ•„ DB μ»¤λ„¥μ… μ μ•½
- **νΈλν”½ μ²λ¦¬λ‰ μ¦κ°€**: κ°™μ€ μ„λ²„λ΅ λ” λ§μ€ μ”μ²­ μ²λ¦¬ κ°€λ¥

### β οΈ μ‚¬μ©ν•λ©΄ μ• λλ” κ²½μ°
- **μ‹¤μ‹κ°„μ„±μ΄ μ¤‘μ”ν• λ°μ΄ν„°**: μ£Όμ‹ κ°€κ²©, μ‹¤μ‹κ°„ μ±„ν…
- **μμ£Ό λ³€κ²½λλ” λ°μ΄ν„°**: μΊμ‹ λ¬΄ν¨ν™” λΉ„μ©μ΄ μΊμ‹ ν¨κ³Όλ³΄λ‹¤ νΌ
- **κ°μΈν™”λ λ°μ΄ν„°**: μ‚¬μ©μλ§λ‹¤ λ‹¤λ¥Έ λ°μ΄ν„°λ” μΊμ‹ ν¨μ¨ λ‚®μ

---

## 1. μΊμ‹ μ „λµ (Caching Strategies)

### Look Aside (Lazy Loading)
*   **λ™μ‘**: λ°μ΄ν„°λ¥Ό μ°Ύμ„ λ• μΊμ‹λ¥Ό λ¨Όμ € ν™•μΈν•κ³ , μ—†μΌλ©΄(Cache Miss) DBμ—μ„ κ°€μ Έμ™€ μΊμ‹μ— μ €μ¥ν•©λ‹λ‹¤.
*   **μ¥μ **: μΊμ‹κ°€ μ£½μ–΄λ„ DBμ—μ„ λ°μ΄ν„°λ¥Ό κ°€μ Έμ¬ μ μμ–΄ μ„λΉ„μ¤ μ¥μ• λ΅ μ΄μ–΄μ§€μ§€ μ•μµλ‹λ‹¤.
*   **λ‹¨μ **: μΊμ‹μ— μ—†λ” λ°μ΄ν„°κ°€ μ²μ μ΅°νλ  λ•(Cold Start) DB λ¶€ν•κ°€ λ°λ¦΄ μ μμµλ‹λ‹¤.
*   **κµ¬ν„**: `@Cacheable` μ–΄λ…Έν…μ΄μ…μ΄ μ΄ ν¨ν„΄μ„ μλ™μΌλ΅ μν–‰ν•©λ‹λ‹¤.

### Write Back (Write Behind)
*   **λ™μ‘**: λ°μ΄ν„°λ¥Ό μΊμ‹μ—λ§ λ¨Όμ € μ“°κ³ , λ‚μ¤‘μ— λ°°μΉ λ“±μΌλ΅ DBμ— ν•κΊΌλ²μ— μ”λ‹λ‹¤.
*   **μ¥μ **: μ“°κΈ° μ„±λ¥μ΄ λ§¤μ° λΉ λ¦…λ‹λ‹¤.
*   **λ‹¨μ **: μΊμ‹κ°€ μ£½μΌλ©΄ λ°μ΄ν„°κ°€ μ μ‹¤λ  μ μμµλ‹λ‹¤. (Spring Cacheλ΅λ” κµ¬ν„μ΄ λ³µμ΅ν•¨)

## 2. μ£Όμ” μ–΄λ…Έν…μ΄μ…

### @Cacheable
*   `@Cacheable(cacheNames = "products", key = "#id")`
*   λ©”μ„λ“ μ‹¤ν–‰ μ „ μΊμ‹λ¥Ό ν™•μΈν•©λ‹λ‹¤. λ°μ΄ν„°κ°€ μμΌλ©΄ λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•μ§€ μ•κ³  μΊμ‹ κ°’μ„ λ¦¬ν„΄ν•©λ‹λ‹¤.

### @CacheEvict
*   `@CacheEvict(cacheNames = "products", key = "#id")`
*   λ°μ΄ν„°κ°€ μμ •λκ±°λ‚ μ‚­μ λ  λ•, μΊμ‹λ λ°μ΄ν„°λ„ ν•¨κ» μ‚­μ ν•μ—¬ **λ°μ΄ν„° λ¶μΌμΉ(Inconsistency)**λ¥Ό λ°©μ§€ν•©λ‹λ‹¤.

### @CachePut
*   `@CachePut(cacheNames = "products", key = "#id")`
*   λ©”μ„λ“ μ‹¤ν–‰ κ²°κ³Όλ¥Ό λ¬΄μ΅°κ±΄ μΊμ‹μ— μ €μ¥(λ®μ–΄μ“°κΈ°)ν•©λ‹λ‹¤. μ£Όλ΅ μμ • λ©”μ„λ“μ— μ‚¬μ©ν•μ—¬ DB μ΅°ν μ—†μ΄ μΊμ‹λ¥Ό μµμ‹ ν™”ν•  λ• μ”λ‹λ‹¤.

## 3. μ‹¤λ¬΄ μ„¤μ • ν¬μΈνΈ (`CacheConfig`)
1.  **μ§λ ¬ν™”(Serialization)**: κΈ°λ³Έ JdkSerializationRedisSerializerλ” μ‚¬λμ΄ μ½μ„ μ μ—†λ” λ°”μ΄λ„λ¦¬λ΅ μ €μ¥λ©λ‹λ‹¤. `GenericJackson2JsonRedisSerializer`λ¥Ό μ‚¬μ©ν•μ—¬ JSON ν•νƒλ΅ μ €μ¥ν•λ” κ²ƒμ΄ λ””λ²„κΉ…μ— μΆ‹μµλ‹λ‹¤.
2.  **TTL(Time To Live)**: μΊμ‹ λ°μ΄ν„°λ” μμ›ν μ €μ¥λλ©΄ μ• λ©λ‹λ‹¤. λΉ„μ¦λ‹μ¤ νΉμ„±μ— λ§κ² λ§λ£ μ‹κ°„μ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. (μ: μƒν’ 10λ¶„, κ³µμ§€μ‚¬ν•­ 1μΌ)

## 4. ν…μ¤νΈ (`CacheTest`)
*   `@SpyBean`μ„ μ‚¬μ©ν•μ—¬ `Repository`μ μ‹¤μ  νΈμ¶ νμλ¥Ό μΉ΄μ΄ν…ν•¨μΌλ΅μ¨ μΊμ‹κ°€ μ λ€λ΅ λ™μ‘ν•λ”μ§€(DB μ΅°νλ¥Ό μ• ν•λ”μ§€) κ²€μ¦ν•  μ μμµλ‹λ‹¤.
